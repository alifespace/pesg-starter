<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>箭头函数中的this</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
    <script>
      fn1 = function () {
        console.log("fn1：", this); // window
      };

      fn2 = () => {
        console.log("fn2：", this); // window
      };

      fn3 = function () {
        console.log("fn3：", this); // window
      };

      fn1();
      fn2();
      fn3();

      const obj1 = {
        name: "孙悟空",
        fn3: fn1,
        fn4: fn2,
        fn5: fn3,
        fn6() {
          console.log("fn6：", this);
          (() => {
            console.log("fn6.1：", this);
          })();
        },
        subobj: {
          fn7: () => {
            console.log("fn7：", this);
          },
          fn7_1() {
            console.log("fn7.1：", this);
          },
        },
        fn8() {
          t1 = function () {
            console.log("fn8.1：", this);
          };
          t1(); // t()以函数形式调用，所以this指向window

          t2 = () => {
            console.log("fn8.2：", this);
          };
          t2(); // t()以箭头函数形式调用，所以this指向obj1
        },
      };
      obj1.fn3(); // object
      obj1.fn4();
      obj1.fn5();
      obj1.fn6();
      obj1.subobj.fn7();
      obj1.subobj.fn7_1();
      obj1.fn8();
    </script>
  </head>
  <body>
    <div id="md-content"></div>
    <pre id="md-source" hidden>

箭头函数中的this
  - 箭头函数没有自己的this，箭头函数的this是箭头函数的外面的this
  - 箭头函数和调用方式无关
  - 箭头函数的this是箭头函数的外面的this: 看箭头函数是如何被访问的

总括来说
- 箭头函数的this，指向的程序中的语义能访问到的函数（就是箭头函数能够找到最接近的外层函数的this）；
- 普通函数的this，指的是调用方法
  - 直接调用就是window
  - 方法调用就是对象

    </pre>

    <script>
      const eID = document.getElementById("md-source");
      const mdText = eID.textContent.trim();
      document.getElementById("md-content").innerHTML = marked.parse(mdText);
      eID.remove();
    </script>
  </body>
</html>
